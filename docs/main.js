(()=>{var l=class{constructor(t,e,n,i,o,w){this.name=t,this.speed=100,this.position={x:200,y:i},this.context=n,this.color=e,this.upKeyCode=o,this.downKeyCode=w,this.direction=0,this.trail=[{x:0,y:i}]}static createPlayer(t){return[new l("right player","orange",t,200,"ArrowUp","ArrowDown")]}static createPlayers(t){return[new l("right player","orange",t,190,"ArrowUp","ArrowDown"),new l("left player","green",t,210,"KeyW","KeyS")]}update(t,e){this.trail.push(this.position),e.isDown(this.upKeyCode)?this.moveUp(t):e.isDown(this.downKeyCode)?this.moveDown(t):this.moveBack(t),this.direction!=0?this.speed=80:this.speed=100;let n=this.speed*t,i=this.position.x+Math.cos(this.direction*(Math.PI/180))*n,o=this.position.y+Math.sin(this.direction*(Math.PI/180))*n;this.position={x:i,y:o}}draw(t,e){this.context.resetTransform(),this.drawTrail(t,e)}drawTrail(t,e){this.cutTrail(t);let n=this.context;n.beginPath(),n.lineWidth=2*e.yScale,n.moveTo((this.trail[0].x-t)*e.xScale,this.trail[0].y*e.yScale);for(let i of this.trail)n.lineTo((i.x-t)*e.xScale,i.y*e.yScale);n.strokeStyle=this.color,n.stroke()}cutTrail(t){this.trail=this.trail.filter(e=>e.x>=t-200)}moveUp(t){let e=-l.angleChangeSpeed*t;this.direction=Math.max(-l.maxAngle,this.direction+e)}moveDown(t){let e=l.angleChangeSpeed*t;this.direction=Math.min(l.maxAngle,this.direction+e)}moveBack(t){let e=l.angleChangeSpeed*t;this.direction>=0?this.direction=Math.max(0,this.direction-e):this.direction=Math.min(0,this.direction+e),this.direction}},y=l;y.maxAngle=30,y.angleChangeSpeed=90;var g=class{constructor(t){this.startLine=2400;this.end=4300;this.squares=[{x:0,y:0,size:50},{x:0,y:400,size:50},{x:200,y:400,size:50},{x:200,y:0,size:50},{x:400,y:400,size:50},{x:400,y:0,size:50},{x:600,y:400,size:50},{x:600,y:0,size:50},{x:800,y:400,size:50},{x:800,y:0,size:50},{x:1e3,y:400,size:50},{x:1e3,y:0,size:50},{x:1200,y:400,size:50},{x:1200,y:0,size:50},{x:1400,y:400,size:50},{x:1400,y:0,size:50},{x:1600,y:400,size:50},{x:1600,y:0,size:50},{x:1620,y:200,size:50},{x:1800,y:400,size:50},{x:1800,y:0,size:50},{x:2e3,y:400,size:50},{x:2e3,y:0,size:50},{x:2200,y:0,size:50},{x:2200,y:400,size:50},{x:2400,y:0,size:100},{x:2400,y:400,size:100},{x:2600,y:200,size:50},{x:2600,y:0,size:100},{x:2600,y:400,size:100},{x:2750,y:320,size:80},{x:2750,y:200,size:80},{x:2750,y:80,size:80},{x:2900,y:400,size:100},{x:2900,y:200,size:100},{x:2900,y:0,size:100},{x:3300,y:0,size:350},{x:3300,y:400,size:350},{x:3800,y:200,size:150},{x:3800,y:0,size:150},{x:3800,y:400,size:150}];this.context=t}collide(t,e){for(let n of this.squares){let i=n.x-n.size/2;if(t>=i&&t<=i+n.size){let o=n.y-n.size/2;if(e>=o&&e<=o+n.size)return!0}}return!1}finish(t){return t>=this.end}draw(t,e){let n=this.context;n.lineWidth=2*e.yScale;for(let i of this.squares){let o=i.x-i.size/2-t,w=i.y-i.size/2;n.strokeStyle="white",n.strokeRect(o*e.xScale,w*e.yScale,i.size*e.xScale,i.size*e.yScale)}t<2500&&(n.font=`${30*e.yScale}px sans-serif`,n.textAlign="left",n.fillStyle="green",n.fillText("Left is green",(400-t)*e.xScale,300*e.yScale),n.fillText("Use 'w' and 's' to move",(800-t)*e.xScale,300*e.yScale),n.fillStyle="orange",n.fillText("Right is orange",(400-t)*e.xScale,130*e.yScale),n.fillText("Use 'up' and 'down' to move",(800-t)*e.xScale,130*e.yScale),n.fillStyle="grey",n.fillText("avoid the squares =>",(1300-t)*e.xScale,210*e.yScale),n.fillStyle="grey",n.fillText("get to finish first!",(1900-t)*e.xScale,210*e.yScale),n.beginPath(),n.moveTo((this.startLine-t)*e.xScale,50*e.yScale),n.lineTo((this.startLine-t)*e.xScale,350*e.yScale),n.strokeStyle="grey",n.stroke()),n.beginPath(),n.moveTo((4300-t)*e.xScale,0*e.yScale),n.lineTo((4300-t)*e.xScale,400*e.yScale),n.strokeStyle="grey",n.stroke()}};var d=class{constructor(t){this.context=t}draw(t,e,n){let i=this.context;i.fillStyle=e,i.fillRect(0,0,400*n.xScale,400*n.yScale),i.font=`${30*n.yScale}px sans-serif`,i.textAlign="center",i.fillStyle="black",i.fillText(t,200*n.xScale,200*n.yScale),i.font=`${20*n.yScale}px sans-serif`,i.fillText("press 'r' to restart",200*n.xScale,230*n.yScale)}};var S=class{constructor(t){this.context=t}draw(t){let e=this.context;e.fillStyle="rgba(20,20,20,0.8)",e.fillRect(0,0,400*t.xScale,400*t.yScale),e.globalAlpha=2,e.font=`${30*t.yScale}px sans-serif`,e.textAlign="center",e.fillStyle="white",e.fillText("paused",200*t.xScale,200*t.yScale)}};var u=[{key:"start-1-p",title:"start single player game",color:"orange"},{key:"start-2-p",title:"start two player game",color:"green"}],v=28,z=class{constructor(t){this.context=t;this.selected=u[0].key}draw(t){let e=this.context;e.fillStyle="black",e.fillRect(0,0,400*t.xScale,400*t.yScale),e.font=`${v*t.yScale}px sans-serif`,e.textAlign="left";let n=200-u.length*v/2;u.forEach((i,o)=>{this.selected==i.key?e.fillStyle=i.color:e.fillStyle="grey",e.fillText(i.title,v*t.xScale,(n+(o+1)*v)*t.yScale)})}handleKey(t){let e=u.findIndex(i=>i.key==this.selected),n="stay";switch(t){case"Enter":{n=this.selected;break}case"ArrowUp":{e>0&&(e=e-1);break}case"ArrowDown":{e<u.length&&(e=e+1);break}}return this.selected=u[e].key,n}};var b=class{constructor(){this.keymap=new Map}isDown(t){return this.keymap.get(t)||!1}onKeydown(t){this.keymap.set(t.code,!0)}onKeyup(t){this.keymap.set(t.code,!1)}};var c,k,m,a=0,A="start-1-p",E,L,D,K,p,s,R=0,f,h,x,T=new b;function U(){if(s.resetTransform(),a==0){K.draw(x);return}if(a==3){D.draw(`\u{1F648} ${E} lost`,"red",x);return}if(a==4){D.draw(`\u{1F680} ${L} won`,"green",x);return}s.clearRect(0,0,f,h),s.fillStyle="black",s.fillRect(0,0,f,h),m.draw(k,x);for(let r of c)r.draw(k,x);a==2&&new S(s).draw(x)}function $(r){if(a!=1)return;for(let e of c)e.update(r,T);k=c.reduce((e,n)=>e+n.position.x,0)/c.length-200;for(let e of c)m.collide(e.position.x,e.position.y)&&(a=3,E=e.name),m.finish(e.position.x)&&(a=4,L=e.name)}function q(r){let t=r-R;R=r,$(t/1e3),U(),window.requestAnimationFrame(q)}function M(){let r=window.innerWidth,t=window.innerHeight;r>t?(f=t,h=t):(f=r,h=r),p.width=f,p.height=h,x={xScale:f/400,yScale:h/400}}function C(r=!0){switch(A){case"start-1-p":{c=y.createPlayer(s);break}case"start-2-p":{c=y.createPlayers(s);break}default:return}if(r==!1)for(let t of c)t.position.x=m.startLine;a=1}function I(r){switch(a){case 3:r.code=="KeyR"&&C(!1);break;case 4:r.code=="KeyR"&&C(!1);break;case 1:r.code=="Space"&&(a=2);break;case 2:r.code=="Space"&&(a=1);break;case 0:A=K.handleKey(r.code),C();break}}function W(){p=document.getElementById("canvas"),f=p.width,h=p.height,k=200,s=p.getContext("2d"),window.addEventListener("keydown",I),window.addEventListener("keydown",r=>T.onKeydown(r)),window.addEventListener("keyup",r=>T.onKeyup(r)),window.addEventListener("resize",M),M(),c=y.createPlayers(s),m=new g(s),D=new d(s),K=new z(s),q(performance.now())}W();})();
//# sourceMappingURL=main.js.map
