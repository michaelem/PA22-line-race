(()=>{var l=class{constructor(t,e,n,i,a,C){this.name=t,this.speed=100,this.position={x:200,y:i},this.context=n,this.color=e,this.upKeyCode=a,this.downKeyCode=C,this.direction=0,this.trail=[{x:0,y:i}]}static createPlayer(t){return[new l("right player","orange",t,200,"ArrowUp","ArrowDown")]}static createPlayers(t){return[new l("right player","orange",t,190,"ArrowUp","ArrowDown"),new l("left player","green",t,210,"KeyW","KeyS")]}update(t,e){this.trail.push(this.position),e.isDown(this.upKeyCode)?this.moveUp(t):e.isDown(this.downKeyCode)?this.moveDown(t):this.moveBack(t),this.direction!=0?this.speed=80:this.speed=100;let n=this.speed*t,i=this.position.x+Math.cos(this.direction*(Math.PI/180))*n,a=this.position.y+Math.sin(this.direction*(Math.PI/180))*n;this.position={x:i,y:a}}draw(t,e){this.context.resetTransform(),this.drawTrail(t,e)}drawTrail(t,e){this.cutTrail(t);let n=this.context;n.beginPath(),n.lineWidth=2*e.yScale,n.moveTo((this.trail[0].x-t)*e.xScale,this.trail[0].y*e.yScale);for(let i of this.trail)n.lineTo((i.x-t)*e.xScale,i.y*e.yScale);n.strokeStyle=this.color,n.stroke()}cutTrail(t){this.trail=this.trail.filter(e=>e.x>=t-200)}moveUp(t){let e=-l.angleChangeSpeed*t;this.direction=Math.max(-l.maxAngle,this.direction+e)}moveDown(t){let e=l.angleChangeSpeed*t;this.direction=Math.min(l.maxAngle,this.direction+e)}moveBack(t){let e=l.angleChangeSpeed*t;this.direction>=0?this.direction=Math.max(0,this.direction-e):this.direction=Math.min(0,this.direction+e),this.direction}},y=l;y.maxAngle=30,y.angleChangeSpeed=90;var d=class{constructor(t){this.startLine=2400;this.end=4300;this.squares=[{x:0,y:0,size:50},{x:0,y:400,size:50},{x:200,y:400,size:50},{x:200,y:0,size:50},{x:400,y:400,size:50},{x:400,y:0,size:50},{x:600,y:400,size:50},{x:600,y:0,size:50},{x:800,y:400,size:50},{x:800,y:0,size:50},{x:1e3,y:400,size:50},{x:1e3,y:0,size:50},{x:1200,y:400,size:50},{x:1200,y:0,size:50},{x:1400,y:400,size:50},{x:1400,y:0,size:50},{x:1600,y:400,size:50},{x:1600,y:0,size:50},{x:1620,y:200,size:50},{x:1800,y:400,size:50},{x:1800,y:0,size:50},{x:2e3,y:400,size:50},{x:2e3,y:0,size:50},{x:2200,y:0,size:50},{x:2200,y:400,size:50},{x:2400,y:0,size:100},{x:2400,y:400,size:100},{x:2600,y:200,size:50},{x:2600,y:0,size:100},{x:2600,y:400,size:100},{x:2750,y:320,size:80},{x:2750,y:200,size:80},{x:2750,y:80,size:80},{x:2900,y:400,size:100},{x:2900,y:200,size:100},{x:2900,y:0,size:100},{x:3300,y:0,size:350},{x:3300,y:400,size:350},{x:3800,y:200,size:150},{x:3800,y:0,size:150},{x:3800,y:400,size:150}];this.context=t}crossedStartLine(t){return t.x>this.startLine}crossedFinishLine(t){return t.x>=this.end}collide(t,e){for(let n of this.squares){let i=n.x-n.size/2;if(t>=i&&t<=i+n.size){let a=n.y-n.size/2;if(e>=a&&e<=a+n.size)return!0}}return!1}draw(t,e){let n=this.context;n.lineWidth=2*e.yScale;for(let i of this.squares){let a=i.x-i.size/2-t,C=i.y-i.size/2;n.strokeStyle="white",n.strokeRect(a*e.xScale,C*e.yScale,i.size*e.xScale,i.size*e.yScale)}t<2500&&(n.font=`${30*e.yScale}px KdamThmorPro-Regular`,n.textAlign="left",n.fillStyle="green",n.fillText("Left is green",(400-t)*e.xScale,300*e.yScale),n.fillText("Use 'w' and 's' to move",(800-t)*e.xScale,300*e.yScale),n.fillStyle="orange",n.fillText("Right is orange",(400-t)*e.xScale,130*e.yScale),n.fillText("Use 'up' and 'down' to move",(800-t)*e.xScale,130*e.yScale),n.fillStyle="grey",n.fillText("avoid the squares =>",(1300-t)*e.xScale,210*e.yScale),n.fillStyle="grey",n.fillText("get to finish first!",(1900-t)*e.xScale,210*e.yScale),n.beginPath(),n.moveTo((this.startLine-t)*e.xScale,50*e.yScale),n.lineTo((this.startLine-t)*e.xScale,350*e.yScale),n.strokeStyle="grey",n.stroke()),n.beginPath(),n.moveTo((4300-t)*e.xScale,0*e.yScale),n.lineTo((4300-t)*e.xScale,400*e.yScale),n.strokeStyle="grey",n.stroke()}};var g=class{constructor(t){this.context=t}draw(t,e,n){let i=this.context;i.fillStyle=e,i.fillRect(0,0,400*n.xScale,400*n.yScale),i.font=`${30*n.yScale}px KdamThmorPro-Regular`,i.textAlign="center",i.fillStyle="black",i.fillText(t,200*n.xScale,200*n.yScale),i.font=`${20*n.yScale}px KdamThmorPro-Regular`,i.fillText("press 'r' to restart",200*n.xScale,230*n.yScale)}};var S=class{constructor(t){this.context=t}draw(t){let e=this.context;e.fillStyle="rgba(20,20,20,0.8)",e.fillRect(0,0,400*t.xScale,400*t.yScale),e.globalAlpha=2,e.font=`${30*t.yScale}px sans-serif`,e.textAlign="center",e.fillStyle="white",e.fillText("paused",200*t.xScale,200*t.yScale)}};var m=[{key:"start-1-p",title:"start single player game",color:"orange"},{key:"start-2-p",title:"start two player game",color:"green"}],z=28,b=class{constructor(t){this.context=t;this.selected=m[0].key}draw(t){let e=this.context;e.fillStyle="black",e.fillRect(0,0,400*t.xScale,400*t.yScale),e.font=`${z*t.yScale}px KdamThmorPro-Regular`,e.textAlign="left";let n=200-m.length*z/2;m.forEach((i,a)=>{this.selected==i.key?e.fillStyle=i.color:e.fillStyle="grey",e.fillText(i.title,z*t.xScale,(n+(a+1)*z)*t.yScale)})}handleKey(t){let e=m.findIndex(i=>i.key==this.selected),n="stay";switch(t){case"Enter":{n=this.selected;break}case"ArrowUp":{e>0&&(e=e-1);break}case"ArrowDown":{e<m.length&&(e=e+1);break}}return this.selected=m[e].key,n}};var v=class{constructor(){this.keymap=new Map}isDown(t){return this.keymap.get(t)||!1}onKeydown(t){this.keymap.set(t.code,!0)}onKeyup(t){this.keymap.set(t.code,!1)}};var x,k,h,o=0,A="start-1-p",E,q,T,R,w,p,s,L=0,f,u,c,K=new v;function P(){if(s.resetTransform(),o==0){R.draw(c);return}if(o==3){T.draw(`\u{1F648} ${E} lost`,"red",c);return}if(o==4){T.draw(`\u{1F680} ${q} won`,"green",c);return}s.clearRect(0,0,f,u),s.fillStyle="black",s.fillRect(0,0,f,u),h.draw(k,c);for(let t of x)t.draw(k,c);s.fillStyle="rgba(128, 20, 20, 0.7)",s.textAlign="right",s.font=`${30*c.yScale}px RobotMono-Regular`;let r=String(w.toFixed(2)).split(".");s.fillText(`${r[0]}:${r[1]}`,390*c.xScale,30*c.yScale),o==2&&new S(s).draw(c)}function U(r){if(o!=1)return;for(let e of x)e.update(r,K);k=x.reduce((e,n)=>e+n.position.x,0)/x.length-200;for(let e of x)h.collide(e.position.x,e.position.y)&&(o=3,E=e.name),h.crossedStartLine(e.position)&&!h.crossedFinishLine(e.position)&&(w=w+r),h.crossedFinishLine(e.position)&&(o=4,q=e.name)}function $(r){let t=r-L;L=r,U(t/1e3),P(),window.requestAnimationFrame($)}function M(){let r=window.innerWidth,t=window.innerHeight;r>t?(f=t,u=t):(f=r,u=r),p.width=f,p.height=u,c={xScale:f/400,yScale:u/400}}function D(r=!0){switch(w=0,A){case"start-1-p":{x=y.createPlayer(s);break}case"start-2-p":{x=y.createPlayers(s);break}default:return}if(r==!1)for(let t of x)t.position.x=h.startLine;o=1}function F(r){switch(o){case 3:r.code=="KeyR"&&D(!1);break;case 4:r.code=="KeyR"&&D(!1);break;case 1:r.code=="Space"&&(o=2);break;case 2:r.code=="Space"&&(o=1);break;case 0:A=R.handleKey(r.code),D();break}}function I(){p=document.getElementById("canvas"),f=p.width,u=p.height,k=200,s=p.getContext("2d"),window.addEventListener("keydown",F),window.addEventListener("keydown",r=>K.onKeydown(r)),window.addEventListener("keyup",r=>K.onKeyup(r)),window.addEventListener("resize",M),M(),x=y.createPlayers(s),h=new d(s),T=new g(s),R=new b(s),$(performance.now())}document.onreadystatechange=()=>{document.readyState==="interactive"&&I()};})();
//# sourceMappingURL=main.js.map
